{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@import-ai/flarum-oauth-passport/webpack/bootstrap","webpack://@import-ai/flarum-oauth-passport/webpack/runtime/compat get default export","webpack://@import-ai/flarum-oauth-passport/webpack/runtime/define property getters","webpack://@import-ai/flarum-oauth-passport/webpack/runtime/hasOwnProperty shorthand","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['forum/app']\"","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['common/extend']\"","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['forum/components/LogInButtons']\"","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['forum/components/LogInButton']\"","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['forum/components/HeaderSecondary']\"","webpack://@import-ai/flarum-oauth-passport/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@import-ai/flarum-oauth-passport/./forum.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButtons'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport LogInButtons from 'flarum/forum/components/LogInButtons';\nimport LogInButton from 'flarum/forum/components/LogInButton';\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\nimport ItemList from 'flarum/common/utils/ItemList';\n\nfunction openOAuthPopup(path) {\n  const fullscreen = app.forum.attribute('importAiOAuthPassport.fullscreenPopup');\n\n  if (fullscreen) {\n    window.open(app.forum.attribute('baseUrl') + path, 'logInPopup', 'fullscreen=yes');\n    return;\n  }\n\n  const width = app.forum.attribute('importAiOAuthPassport.popupWidth') || 580;\n  const height = app.forum.attribute('importAiOAuthPassport.popupHeight') || 400;\n  const top = window.innerHeight / 2 - height / 2;\n  const left = window.innerWidth / 2 - width / 2;\n\n  window.open(\n    app.forum.attribute('baseUrl') + path,\n    'logInPopup',\n    `width=${width},height=${height},top=${top},left=${left},status=no,scrollbars=yes,resizable=no`\n  );\n}\n\n// Handle oauth_token for in-app browser OAuth flow\nconst urlParams = new URLSearchParams(window.location.search);\nconst oauthToken = urlParams.get('oauth_token');\n\nif (oauthToken) {\n  const payload = { token: oauthToken };\n  const username = urlParams.get('oauth_username');\n  const email = urlParams.get('oauth_email');\n  const provided = urlParams.get('oauth_provided');\n\n  if (username) payload.username = username;\n  if (email) payload.email = email;\n  if (provided) payload.provided = provided.split(',');\n\n  window.history.replaceState({}, document.title, window.location.pathname + window.location.hash);\n  app.authenticationComplete(payload);\n}\n\nfunction adjustColor(color, amount) {\n  const num = parseInt(color.replace('#', ''), 16);\n  const r = Math.min(255, Math.max(0, (num >> 16) + amount));\n  const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00ff) + amount));\n  const b = Math.min(255, Math.max(0, (num & 0x0000ff) + amount));\n  return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;\n}\n\nfunction applyDynamicStyles() {\n  const buttonColor = app.forum.attribute('importAiOAuthPassport.buttonColor');\n  const buttonTextColor = app.forum.attribute('importAiOAuthPassport.buttonTextColor');\n  const replaceLoginSignup = app.forum.attribute('importAiOAuthPassport.replaceLoginSignup');\n\n  if (buttonColor || buttonTextColor) {\n    const style = document.createElement('style');\n    style.textContent = `\n      .LogInButton--passport {\n        ${buttonColor ? `background-color: ${buttonColor} !important;` : ''}\n        ${buttonTextColor ? `color: ${buttonTextColor} !important;` : ''}\n      }\n      .LogInButton--passport:hover,\n      .LogInButton--passport:focus {\n        ${buttonColor ? `background-color: ${adjustColor(buttonColor, -20)} !important;` : ''}\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  if (replaceLoginSignup) {\n    const hideStyle = document.createElement('style');\n    hideStyle.textContent = `\n      .LogInModal .Form--centered > .Form-group:first-child,\n      .LogInModal .Form--centered > .Form-group:nth-child(2),\n      .LogInModal .Form--centered > .Form-group:nth-child(3),\n      .LogInModal .Form--centered > .Form-group:last-child,\n      .LogInModal .LogInModal-divider,\n      .LogInModal .Modal-footer {\n        display: none !important;\n      }\n    `;\n    document.head.appendChild(hideStyle);\n  }\n}\n\nfunction initLoginButtons() {\n  if (!app.forum) {\n    setTimeout(initLoginButtons, 10);\n    return;\n  }\n\n  const enabled = app.forum.attribute('importAiOAuthPassport.enabled');\n  const replaceLoginSignup = app.forum.attribute('importAiOAuthPassport.replaceLoginSignup');\n\n  if (!enabled) return;\n\n  if (replaceLoginSignup) {\n    const hideStyle = document.createElement('style');\n    hideStyle.textContent = '.Header-secondary .item-logIn, .Header-secondary .item-signUp { display: none !important; }';\n    document.head.appendChild(hideStyle);\n\n    override(LogInButtons.prototype, 'items', () => {\n      const items = new ItemList();\n      items.add('import-ai-oauth-passport', LogInButton.component({\n        className: 'Button LogInButton--passport',\n        icon: app.forum.attribute('importAiOAuthPassport.loginIcon'),\n        path: '/auth/passport',\n      }, app.forum.attribute('importAiOAuthPassport.loginTitle')));\n      return items;\n    });\n  } else {\n    extend(LogInButtons.prototype, 'items', (items) => {\n      items.add('import-ai-oauth-passport', LogInButton.component({\n        className: 'Button LogInButton--passport',\n        icon: app.forum.attribute('importAiOAuthPassport.loginIcon'),\n        path: '/auth/passport',\n      }, app.forum.attribute('importAiOAuthPassport.loginTitle')));\n    });\n  }\n}\n\n// Intercept clicks on passport login buttons to use custom popup dimensions\ndocument.addEventListener('click', function(event) {\n  const button = event.target.closest('button.LogInButton, a.LogInButton');\n  if (!button) return;\n\n  const targetPath = button.getAttribute('path') || button.getAttribute('href') || '';\n  if (!targetPath.includes('/auth/passport')) return;\n\n  event.preventDefault();\n  event.stopPropagation();\n  openOAuthPopup('/auth/passport');\n}, true);\n\n// Add OAuth button to header in replace mode\nextend(HeaderSecondary.prototype, 'items', function (items) {\n  if (!app.forum) return;\n\n  const replaceLoginSignup = app.forum.attribute('importAiOAuthPassport.replaceLoginSignup');\n  const enabled = app.forum.attribute('importAiOAuthPassport.enabled');\n\n  if (replaceLoginSignup && enabled && !app.session.user) {\n    items.add('oauth-login', LogInButton.component({\n      className: 'Button Button--link',\n      icon: app.forum.attribute('importAiOAuthPassport.loginIcon'),\n      path: '/auth/passport',\n    }, app.forum.attribute('importAiOAuthPassport.loginTitle')), 15);\n  }\n});\n\n// Initialize\nfunction init() {\n  if (!app.forum) {\n    setTimeout(init, 10);\n    return;\n  }\n  applyDynamicStyles();\n}\n\ninit();\ninitLoginButtons();\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","urlParams","URLSearchParams","window","location","search","oauthToken","payload","token","username","email","provided","split","history","replaceState","document","title","pathname","hash","app","addEventListener","event","button","target","closest","getAttribute","includes","preventDefault","stopPropagation","path","attribute","open","width","height","top","innerHeight","left","innerWidth","openOAuthPopup","extend","HeaderSecondary","items","replaceLoginSignup","enabled","user","add","LogInButton","className","icon","init","num","buttonColor","buttonTextColor","style","createElement","textContent","parseInt","replace","Math","min","max","toString","padStart","head","appendChild","hideStyle","applyDynamicStyles","setTimeout","initLoginButtons","override","LogInButtons","ItemList"],"ignoreList":[],"sourceRoot":""}